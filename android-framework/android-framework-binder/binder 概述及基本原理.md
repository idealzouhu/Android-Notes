## Binder 概述







### 为什么需要 Binder

很多时候，提供系统功能的数据和函数都会放在固定的几个进程中（比如显示画面，播放声音等），我们编写的用户程序要实现相应的功能就需要通过**跨进程通信技术**来访问这些数据和函数。





## Binder 基本原理

Binder 是 Android 系统中最核心的 **IPC（进程间通信）** 机制，其高性能和安全性依赖于两个关键技术：

- **`mmap()`**：通过内存映射实现零拷贝数据传输*
  - 将内核空间和用户空间的内存映射到同一块物理内存，避免数据在两者之间的多次拷贝。
  - Binder 驱动通过 `mmap()` 为通信的进程分配共享内存区域，发送方和接收方直接操作这块内存，无需通过内核中转。
- **`copy_from_user()`** : **用户态到内核态的安全拷贝**
  - 当进程向 Binder 驱动发送数据时，需将数据从**用户空间**（App 进程）拷贝到**内核空间**（Binder 驱动）。

[写给应用开发的 Android Framework 教程——学穿 Binder 篇之 Binder 基本原理0. 虚拟地 - 掘金](https://juejin.cn/post/7210175991837392933)



### 跨进程通信的基本思路

在 linux 中，每个进程都有自己的虚拟内存地址空间。虚拟内存地址空间又分为了用户地址空间和内核地址空间。**不同进程之间用户地址空间的变量和函数是不能相互访问的**。



虽然用户地址空间是不能互相访问的，但是不同进程的内核地址空间是相同和共享的，我们可以**借助内核地址空间作为中转站来实现进程间数据的传输**。





### 优化方案 —— binder 原理

通过 mmap 将进程 A 的用户地址空间与内核地址空间进行映射，让他们指向相同的物理地址空间。完成映射后，B 进程只需调用一次 copyfromuser，A 进程的用户空间中就可以访问到 `int a`了。

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8eb133678644a93bec1ed13d53ccd79~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)